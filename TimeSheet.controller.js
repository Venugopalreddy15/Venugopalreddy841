sap.ui.define(["./BaseController","sap/ui/model/json/JSONModel","../model/formatter","sap/ui/model/Filter","sap/ui/model/FilterOperator"],function(e,t,a,o,r){"use strict";return e.extend("ProjectTime.ZProjectTime.controller.TimeSheet",{formatter:a,onInit:function(){var e=this;var a=e.getView();var o=$.sap.getModulePath("ProjectTime.ZProjectTime","/Images/download.jpg");var r={Notes:"",VacationNotes:"",VacationNotesVisible:false,Image:o,tableColumns:[],StartDateMonth:"",EndDateMonth:"",PreviousButton:true,NextButton:true,user:"",usereditable:false,NoOfWeeksInYear:52,firstTimeUser:{Monday:true,Saturday:true,Sunday:true},tableItems:[{ProjectCode:"GOV-445;Nisco SC",ResourceType:"ResourceType1",Monday:"0.00",Tuesday:"0.00",Wedesday:"0.00",Tursday:"0.00",Friday:"0.00",Saturday:"0.00",Sunday:"0.00",TotalHours:"0.00",Day0valueStateText:"",Day0valueState:"None",Day1valueStateText:"",Day1valueState:"None",Day2valueStateText:"",Day2valueState:"None",Day3valueStateText:"",Day3valueState:"None",Day4valueStateText:"",Day4valueState:"None",Day5valueStateText:"",Day5valueState:"None",Day6valueStateText:"",Day6valueState:"None",Day7valueStateText:"",Day7valueState:"None",Notes:"Notes1"}]};var s=new t(r);a.setModel(s,"oTimeshetModel");var i=new t;a.setModel(i,"oUserModel");var n=new t(r);a.setModel(n,"oNewProjectModel");var l={WBS:"",Description:"",ProjectDefination:""};var u=new t(l);a.setModel(u,"oFileterModel");var g=new t;a.setModel(g,"oNotesModel");var c;if(this.getOwnerComponent().user==="X"){s.getData()["WeekNumber"]=this.getOwnerComponent().week;s.getData()["Year"]=this.getOwnerComponent().year;c=this.getDateOfISOWeek(this.getOwnerComponent().week,this.getOwnerComponent().year);s.getData()["user"]="X"}else{var d=this.getWeekNumber(new Date);s.getData()["WeekNumber"]=d[1];s.getData()["Year"]=d[0];c=this.getDateOfISOWeek(d[1],d[0])}s.updateBindings(true);this.getNextSevenDates(c);this.UserDetails();this.Timer();this._GetData();this._GetNotes();this._setTitle();this.ValidateFrstUser();this.getWeeksinYear(s.getProperty("/Year"));$("input[type='number']").on("click",function(){$(this).select()})},getWeeksinYear:function(e){var t=this;var a=t.getView();var o=a.getModel("oTimeshetModel");var r,s;r=new Date(e,0,1);s=new Date(e,1,29).getMonth()===1;if(r.getDay()===4||s&&r.getDay()===3){o.setProperty("/NoOfWeeksInYear",53)}else{o.setProperty("/NoOfWeeksInYear",52)}},onUpdateFinished:function(e){var t=this;var a=e.getSource();var o;a.addEventDelegate({onAfterRendering:function(e){var t=e.srcControl.getItems();for(var a=0;a<t.length;a++){o=t[a].getCells()[1].getItems();for(var r=0;r<o.length;r++){o[r].addEventDelegate({onfocusin:function(){$("input[type='number']").on("click",function(){$(this).select()})}})}}}},this)},ValidateFrstUser:function(){var e=this;var t,a,o;var r=e.getView();var s=e.getView().getModel("oTimeshetModel");var i=s.getProperty("/tableColumns");var n=s.getProperty("/tableItems");var l=s.getProperty("/WeekNumber");var u=s.getProperty("/Year");s.setProperty("/firstTimeUser/Monday",false);s.setProperty("/firstTimeUser/Tuesday",false);s.setProperty("/firstTimeUser/Wednesday",false);s.setProperty("/firstTimeUser/Thursday",false);s.setProperty("/firstTimeUser/Friday",false);s.setProperty("/firstTimeUser/Saturday",false);s.setProperty("/firstTimeUser/Sunday",false);if(n.length>0){t=n[0].StartDate;o=t.substring(0,4)+"/"+t.substring(4,6)+"/"+t.substring(6,8);t=new Date(o);a=t.getTime();var g=this.getWeekNumber(t);if(i[2].Date.getTime()<a){s.setProperty("/firstTimeUser/Monday",true)}if(i[3].Date.getTime()<a){s.setProperty("/firstTimeUser/Tuesday",true)}if(i[4].Date.getTime()<a){s.setProperty("/firstTimeUser/Wednesday",true)}if(i[5].Date.getTime()<a){s.setProperty("/firstTimeUser/Thursday",true)}if(i[6].Date.getTime()<a){s.setProperty("/firstTimeUser/Friday",true)}if(i[7].Date.getTime()<a){s.setProperty("/firstTimeUser/Saturday",true)}if(i[8].Date.getTime()<a){s.setProperty("/firstTimeUser/Sunday",true)}}},_setTitle:function(){var e=this;var t=e.getView().getModel("oTimeshetModel");if(sap.ui.Device.system.phone){this.getView().getContent()[0].setTitle("Time Sheet ( Week #"+t.getProperty("/WeekNumber")+" )")}else{this.getView().getContent()[0].setTitle("Time Sheet for "+t.getProperty("/StartDateMonth")+"-"+t.getProperty("/EndDateMonth")+" - "+"(Week #"+t.getProperty("/WeekNumber")+")")}},onGoSearchPress:function(){var e=this;var t=e.getView();var a=t.getModel("oFileterModel");var o=e.getView().getModel("oTimeshetModel");var r=o.getProperty("/WeekNumber");var s=o.getProperty("/Year");var i=a.getProperty("/WBS");var n=a.getProperty("/Description");var l=a.getProperty("/ProjectDefination");var u=[];var g;u.push(new sap.ui.model.Filter("ProjectCode",sap.ui.model.FilterOperator.EQ,i));u.push(new sap.ui.model.Filter("Txt",sap.ui.model.FilterOperator.EQ,n));u.push(new sap.ui.model.Filter("Project_Def",sap.ui.model.FilterOperator.EQ,l));u.push(new sap.ui.model.Filter("WeekNo",sap.ui.model.FilterOperator.EQ,r));u.push(new sap.ui.model.Filter("Year",sap.ui.model.FilterOperator.EQ,s));if(sap.ui.Device.system.phone){g="MidWBSTable"}else{g="idWBSTable"}var c=sap.ui.getCore().byId(g);c.getBinding("items").filter(u)},onRefreshSearchPress:function(){var e=this;var t=e.getView();var a=[];var o=sap.ui.getCore().byId("idWBSTable");o.getBinding("items").filter(a)},onsave_submitvalidation:function(){var e=this;var t=e.getView();var a=jQuery.Deferred();var o=t.getModel("oTimeshetModel");var r={WeekNo:o.getProperty("/WeekNumber").toLocaleString(),User:""};var s=this.getOwnerComponent().getModel();s.create("/WbsValidationSet",r,{success:function(e){a.resolve("success")},error:function(e){a.resolve("error")}});return a},onSubmitPress:function(e){var t=this;var a=t.getView();t.oCustomDataValue=e.getSource().getCustomData()[0].getValue();var o=a.getModel("oTimeshetModel");var r=o.getData();if(parseFloat(r.tableColumns[9].Total)<37.5){sap.m.MessageBox.show("Total hours submitted for this week are less than 37.5 hours. Do you still want to proceed?",{icon:sap.m.MessageBox.Icon.INFORMATION,title:"Warning",actions:[sap.m.MessageBox.Action.YES,sap.m.MessageBox.Action.NO],onClose:function(a){if(a==="YES"){t.onSavePress(e,t.oCustomDataValue)}}})}else{t.onSavePress(e,t.oCustomDataValue)}},validate:function(){var e=this;var t=e.getView();var a=t.getModel("oTimeshetModel");var o=a.getData();var r=o.tableItems;var s=false;for(var i=2;i<=8;i++){if(o.tableColumns[i].Total>24){s=true;return s}}for(var n=0;n<r.length;n++){if(r[n].Day0valueState==="Error"||r[n].Day1valueState==="Error"||r[n].Day2valueState==="Error"||r[n].Day3valueState==="Error"||r[n].Day4valueState==="Error"||r[n].Day5valueState==="Error"||r[n].Day6valueState==="Error"){s=true;return s}}},onSavePress:function(e,t){var a=this;var o=a.getView();a.RowColumnCal();if(!t){t=e.getSource().getCustomData()[0].getValue()}var r,s;var i=o.getModel("oTimeshetModel");var n=i.getData();var l=this.getOwnerComponent().getModel();l.setUseBatch(true);l.setDeferredGroups(["UpdateTimeSheet"]);if(t==="Submit"){s="X"}else{s=""}if(t==="Save"){this.Saved="X"}else{this.Saved=""}var u=a.onsave_submitvalidation();u.then(function(e){if(e!="error"){if(!a.validate()){for(var u=0;u<n.tableItems.length;u++){r={Projectcode:n.tableItems[u].Projectcode,ResourceType:n.tableItems[u].ResourceType,WeekNo:n.tableItems[u].WeekNo+"",User:n.tableItems[u].User,Year:n.tableItems[u].Year+"",ProjectDesc:n.tableItems[u].ProjectDesc,TypeDesc:n.tableItems[u].TypeDesc,Day01:n.tableItems[u].Day01,Day02:n.tableItems[u].Day02,Day03:n.tableItems[u].Day03,Day04:n.tableItems[u].Day04,Day05:n.tableItems[u].Day05,Day06:n.tableItems[u].Day06,Day07:n.tableItems[u].Day07,Note:n.tableItems[u].Note,StartDate:n.tableItems[u].StartDate,WBSType:n.tableItems[u].WBSType,Lock:s};if(n.tableItems[u].WBSType==="V"||n.tableItems[u].WBSType==="C"){r.Note=n.VacationNotes}var g=encodeURIComponent(n.tableItems[u].Projectcode);var c="/TimeSheetSet(Projectcode='"+g+"',ResourceType='"+n.tableItems[u].ResourceType+"',WeekNo='"+n.tableItems[u].WeekNo+"',User='',Year='"+n.tableItems[u].Year+"')";l.update(c,r,{merge:false,groupId:"UpdateTimeSheet"})}var d=o.getModel("oNotesModel");var p={User:"",WeekNo:d.getProperty("/WeekNo"),Year:d.getProperty("/Year"),Day01:d.getProperty("/Day01"),Day02:d.getProperty("/Day02"),Day03:d.getProperty("/Day03"),Day04:d.getProperty("/Day04"),Day05:d.getProperty("/Day05"),Day06:d.getProperty("/Day06"),Day07:d.getProperty("/Day07"),Lock:s};var v="/NotesSet(User='',WeekNo='"+n.WeekNumber+"',Year='"+n.Year+"')";l.update(v,p,{merge:false,groupId:"UpdateTimeSheet"});sap.ui.core.BusyIndicator.show();l.submitChanges({groupId:"UpdateTimeSheet",success:function(e){a._GetData();a.Saved="";i.setProperty("/usereditable",false);if(t==="Submit"){sap.m.MessageToast.show("Timesheet Submitted Successfully")}else if(t==="Save"){sap.m.MessageToast.show("Timesheet Saved Successfully")}sap.ui.core.BusyIndicator.hide()},error:function(e){sap.ui.core.BusyIndicator.hide()}})}else{sap.m.MessageToast.show("Please Correct the Time highlight in red Color ")}}})},handleBatchSuccess:function(e,t){},_GetNotes:function(){var e=this;var t=e.getView();var a;var o=t.getModel("oTimeshetModel");var r=o.getData();var s=t.getModel("oNotesModel");var i=this.getOwnerComponent().getModel();var n=[];n.push(new sap.ui.model.Filter("WeekNo",sap.ui.model.FilterOperator.EQ,r.WeekNumber));n.push(new sap.ui.model.Filter("User",sap.ui.model.FilterOperator.EQ,""));n.push(new sap.ui.model.Filter("Year",sap.ui.model.FilterOperator.EQ,r.Year));var l="/NotesSet(User='',WeekNo='"+r.WeekNumber+"',Year='"+r.Year+"')";sap.ui.core.BusyIndicator.show();i.read(l,{success:function(e){s.setData(e);s.updateBindings(true);sap.ui.core.BusyIndicator.hide()},error:function(e){sap.ui.core.BusyIndicator.hide()}})},_GetData:function(){var e=this;var t=e.getView();var a;var o=t.getModel("oTimeshetModel");o.setProperty("/tableItems",[]);var r=t.byId("dtimesheetTable");var s=r.getModel("oTimeshetModel");var i=o.getData();var n=this.getOwnerComponent().getModel();var l=[];var u={TotalHours:"0.00",Day0valueStateText:"",Day0valueState:"None",Day1valueStateText:"",Day1valueState:"None",Day2valueStateText:"",Day2valueState:"None",Day3valueStateText:"",Day3valueState:"None",Day4valueStateText:"",Day4valueState:"None",Day5valueStateText:"",Day5valueState:"None",Day6valueStateText:"",Day6valueState:"None",Day7valueStateText:"",Day7valueState:"None"};l.push(new sap.ui.model.Filter("WeekNo",sap.ui.model.FilterOperator.EQ,i.WeekNumber));l.push(new sap.ui.model.Filter("Year",sap.ui.model.FilterOperator.EQ,i.Year));sap.ui.core.BusyIndicator.show(1e3);n.read("/TimeSheetSet",{filters:l,success:function(t){o.setProperty("/tableItems",[]);a=t.results;for(var r=0;r<a.length;r++){if(a[r].WBSType==="V"||a[r].WBSType==="C"){i.VacationNotes=a[r].Note;i.VacationNotesVisible=true}var n=$.extend({},u,a[r]);i.tableItems.push(n)}s.refresh(false);o.updateBindings(true);e.RowColumnCal();e.ValidateFrstUser();s.refresh(true);sap.ui.core.BusyIndicator.hide()},error:function(e){sap.ui.core.BusyIndicator.hide()}})},_getPreviousNextData:function(e,t,a){var o=this;var r=o.getView();var s;var i=r.getModel("oTimeshetModel");i.setProperty("/tableItems",[]);var n=i.getData();var l=this.getOwnerComponent().getModel();var u=[];u.push(new sap.ui.model.Filter("WeekNo",sap.ui.model.FilterOperator.EQ,e));u.push(new sap.ui.model.Filter("Year",sap.ui.model.FilterOperator.EQ,t));sap.ui.core.BusyIndicator.show();l.read("/TimeSheetSet",{filters:u,success:function(e){s=e.results;if(s.length===0&&a==="P"){i.setProperty("/PreviousButton",false);i.setProperty("/NextButton",true)}else{i.setProperty("/PreviousButton",true)}if(s.length===0&&a==="N"){i.setProperty("/NextButton",false);i.setProperty("/PreviousButton",true)}else{i.setProperty("/NextButton",true)}sap.ui.core.BusyIndicator.hide()},error:function(e){sap.ui.core.BusyIndicator.hide()}})},Timer:function(){var e=new Date;var t=e.setMinutes(e.getMinutes()+5);window.IDLE_TIMEOUT=t;this._idleSecondsTimer=null;this._idleSecondsCounter=0;document.onclick=function(){e=new Date;t=e.setMinutes(e.getMinutes()+5);window.IDLE_TIMEOUT=t};document.onmousemove=function(){e=new Date;t=e.setMinutes(e.getMinutes()+5);window.IDLE_TIMEOUT=t};document.onkeypress=function(){e=new Date;t=e.setMinutes(e.getMinutes()+5);window.IDLE_TIMEOUT=t};window.X=window.setInterval(function(){var e=(new Date).getTime();var t=window.IDLE_TIMEOUT-e;if(t<0){window.clearInterval(window.X);sap.m.MessageBox.information("Your session expired. please click Ok to restart",{styleClass:"Cancelbuttons",actions:[sap.m.MessageBox.Action.OK],onClose:function(e){window.location.reload()}})}})},onHelpIconPress:function(e){var t=e.getSource();if(!this._oHelpPopover){this._oHelpPopover=sap.ui.xmlfragment("ProjectTime.ZProjectTime.fragment.Help",this);this.getView().addDependent(this._oHelpPopover)}this._oHelpPopover.openBy(t)},UserDetails:function(){var e=this;var t=e.getView();var a=e.getOwnerComponent().getModel("UserDetailModel");var o=t.getModel("oUserModel");var r="/UserDetails('')";sap.ui.core.BusyIndicator.show();a.read(r,{success:function(e){o.setData(e);o.updateBindings(false);sap.ui.core.BusyIndicator.hide()},error:function(e){sap.ui.core.BusyIndicator.hide()}})},generateAvatar:function(e){if(e){var t=e.split(" ").map(function(e){return e?e[0].toUpperCase():""}).join("");var a=document.createElement("canvas");var o=30;var r=5;a.width=o*2+r*2;a.height=o*2+r*2;var s=a.getContext("2d");s.beginPath();s.arc(o+r,o+r,o,0,2*Math.PI,false);s.closePath();s.fillStyle="grey";s.fill();s.fillStyle="white";s.font="bold 30px Arial";s.textAlign="center";s.fillText(t,o+5,o*4/3+r);return a.toDataURL()}},handlePreviousPress:function(){var e=this;var t=e.getView();var a=new Date;var o;var r=t.getModel("oTimeshetModel");var s;var i=a.getFullYear();var n=r.getProperty("/NoOfWeeksInYear");var l=r.getProperty("/StartDateofTitle");var u=l.getFullYear();if(r.getData()["WeekNumber"]===1){if(!(l.getDate()>28&&l.getDate()<=31)){u=u-1}this.getWeeksinYear(u);s=r.getProperty("/NoOfWeeksInYear")}else{s=r.getData()["WeekNumber"]-1}var g=e.getDateOfISOWeek(s,u);e.getNextSevenDates(g);r.getData()["WeekNumber"]=s;r.updateBindings(false);e.UserDetails();e.Timer();e._GetData();if(r.getData()["WeekNumber"]===1){if(!(l.getDate()>28&&l.getDate()<=31)){u=u-1}this.getWeeksinYear(u);o=r.getProperty("/NoOfWeeksInYear")}else{o=s-1}e._getPreviousNextData(o,u,"P");e.ValidateFrstUser();e._GetNotes();e._setTitle();r.setProperty("/usereditable",false)},onPreviousPress:function(e){var t=new sap.m.BusyDialog;t.open();t.setBusy(true);var a=this;var o=a.getView();var r=o.getModel("oTimeshetModel");var s;if(r.getData().tableItems.length){s=r.getData().tableItems[0].Lock}else{s=""}if(r.getProperty("/usereditable")&&s!="X"&&this.Saved!="X"){sap.m.MessageBox.show("Do you want to save your changes?",{icon:sap.m.MessageBox.Icon.WARNING,title:"Confirm",actions:[sap.m.MessageBox.Action.YES,sap.m.MessageBox.Action.NO],onClose:function(o){if(o==="YES"){a.onSavePress(e,"Save");r.setProperty("/usereditable",false);t.close()}else{a.handlePreviousPress();t.close()}}})}else{a.handlePreviousPress();t.close()}},handleNextPress:function(){var e=this;var t=e.getView();var a=new Date;var o;var r=a.getFullYear();var s=t.getModel("oTimeshetModel");var i=s.getProperty("/StartDateofTitle");var n=i.getFullYear();var l;var u=this.getWeekNumber(i);s.getData()["WeekNumber"]=u[1];var g=s.getProperty("/NoOfWeeksInYear");if(s.getData()["WeekNumber"]===g){l=1;n=n+1}else{l=s.getData()["WeekNumber"]+1;n=s.getProperty("/EndDateofTitle").getFullYear()}var c=this.getDateOfISOWeek(l,n);this.getNextSevenDates(c);s.getData()["WeekNumber"]=l;s.updateBindings(false);this.UserDetails();this.Timer();this._GetData();if(s.getData()["WeekNumber"]===g){n=n+1;o=1}else{o=l+1}this._getPreviousNextData(o,n,"N");this.ValidateFrstUser();this._GetNotes();this._setTitle();s.setProperty("/usereditable",false)},onNextPress:function(e){var t=new sap.m.BusyDialog;t.open();t.setBusyIndicatorDelay(0);var a=this;var o=a.getView();var r=o.getModel("oTimeshetModel");var s;if(r.getData().tableItems.length){s=r.getData().tableItems[0].Lock}else{s=""}if(r.getProperty("/usereditable")&&s!="X"&&this.Saved!="X"){sap.m.MessageBox.show("Do you want to save your changes?",{icon:sap.m.MessageBox.Icon.WARNING,title:"Confirm",actions:[sap.m.MessageBox.Action.YES,sap.m.MessageBox.Action.NO],onClose:function(o){if(o==="YES"){a.onSavePress(e,"Save");r.setProperty("/usereditable",false);t.close()}else{a.handleNextPress();t.close()}}})}else{a.handleNextPress();t.close()}},getNextSevenDates:function(e){var t=this;var a=t.getView();var o=a.getModel("oTimeshetModel");var r=t.startOfWeek(e);o.getData().StartDateMonth=r.getDate()+" "+this.MonthAsString(r.getMonth());o.getData().Year=r.getFullYear();var s=r;var i=this.GetDates(s,6);t.formJson(i);o.updateBindings(true)},getDateOfISOWeek:function(e,t){var a=new Date(t,0,1+(e-1)*7);var o=a.getDay();var r=a;if(o<=4)r.setDate(a.getDate()-a.getDay()+1);else r.setDate(a.getDate()+8-a.getDay());return r},getWeekNumber:function(e){e=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate()));e.setUTCDate(e.getUTCDate()+4-(e.getUTCDay()||7));var t=new Date(Date.UTC(e.getUTCFullYear(),0,1));var a=Math.ceil(((e-t)/864e5+1)/7);return[e.getUTCFullYear(),a]},formJson:function(e){var t=this;var a=t.getView().getModel("oTimeshetModel");var o=a.getData().tableColumns;o=[];o.push({Column:"Project Code"},{Column:"Resource Type"});for(var r=0;r<e.length;r++){o.push({Column:e[r].DisplayDate,Date:e[r].Date})}o.push({Column:"Sub Totals"},{Column:"Project Notes"});a.setProperty("/tableColumns",o)},onWeekDayChange:function(e){var t=this;var a=t.getView();var o=e.getSource().getValue();var r=a.getModel("oTimeshetModel");r.setProperty("/usereditable",true);var s=e.getSource();var i=s.getCustomData()[0].getKey();var n=s.getCustomData()[0].getValue();var l=s.getBindingContext("oTimeshetModel").getObject();var u=s.getBindingContext("oTimeshetModel").getPath();e.getSource().setValue(parseFloat(o).toFixed(2));var g=/^[-+]?(?:[0-9][0-9]*|(?:[0-9][0-9]*)?\.(?:25|5|75|00))$/;var c=parseFloat(e.getSource().getValue());var d=true;if(c){d=g.test(parseFloat(e.getSource().getValue()))}var p=false;var v;var m=s.getCustomData()[1].getKey();r.setProperty(u+"/"+i,"None");r.setProperty(u+"/"+n,"");if(parseFloat(e.getSource().getValue())>24){p=true;r.setProperty(u+"/"+i,"Error");r.setProperty(u+"/"+n,"Time Cann't be GT 24 Hrs")}else if(!d){p=true;r.setProperty(u+"/"+i,"Error");r.setProperty(u+"/"+n,"Must enter increments of 0.25, 0.50 or 0.75")}if(!p){if(e.getSource().getValue()===""){e.getSource().setValue(parseFloat(0).toFixed(2))}var y=r.getData().tableItems;var D=parseFloat(l.Day01)+parseFloat(l.Day02)+parseFloat(l.Day03)+parseFloat(l.Day04)+parseFloat(l.Day05)+parseFloat(l.Day06)+parseFloat(l.Day07);l.TotalHours=D.toFixed(2);r.updateBindings(true);var h=0,f=0,T=0,P=0,S=0,M=0,N=0,w=0;for(var b=0;b<y.length;b++){h=(parseFloat(h)+parseFloat(y[b].Day01)).toFixed(2);f=(parseFloat(f)+parseFloat(y[b].Day02)).toFixed(2);T=(parseFloat(T)+parseFloat(y[b].Day03)).toFixed(2);P=(parseFloat(P)+parseFloat(y[b].Day04)).toFixed(2);S=(parseFloat(S)+parseFloat(y[b].Day05)).toFixed(2);M=(parseFloat(M)+parseFloat(y[b].Day06)).toFixed(2);N=(parseFloat(N)+parseFloat(y[b].Day07)).toFixed(2);w=(parseFloat(w)+parseFloat(y[b].TotalHours)).toFixed(2)}r.getData().tableColumns[0]["Total"]="Sub Totals";r.getData().tableColumns[2]["Total"]=h;r.getData().tableColumns[3]["Total"]=f;r.getData().tableColumns[4]["Total"]=T;r.getData().tableColumns[5]["Total"]=P;r.getData().tableColumns[6]["Total"]=S;r.getData().tableColumns[7]["Total"]=M;r.getData().tableColumns[8]["Total"]=N;r.getData().tableColumns[9]["Total"]=w;t.getView().byId("idProgressIndicator").setPercentValue(+w);r.updateBindings(true);if(m==="Day01"){if(h>24){r.setProperty(u+"/"+i,"Error");r.setProperty(u+"/"+n,"Daily Time Cann't be GT 24 Hrs")}}if(m==="Day02"){if(f>24){r.setProperty(u+"/"+i,"Error");r.setProperty(u+"/"+n,"Daily Time Cann't be GT 24 Hrs")}}if(m==="Day03"){if(T>24){r.setProperty(u+"/"+i,"Error");r.setProperty(u+"/"+n,"Daily Time Cann't be GT 24 Hrs")}}if(m==="Day04"){if(P>24){r.setProperty(u+"/"+i,"Error");r.setProperty(u+"/"+n,"Daily Time Cann't be GT 24 Hrs")}}if(m==="Day05"){if(S>24){r.setProperty(u+"/"+i,"Error");r.setProperty(u+"/"+n,"Daily Time Cann't be GT 24 Hrs")}}if(m==="Day06"){if(M>24){r.setProperty(u+"/"+i,"Error");r.setProperty(u+"/"+n,"Daily Time Cann't be GT 24 Hrs")}}if(m==="Day07"){if(N>24){r.setProperty(u+"/"+i,"Error");r.setProperty(u+"/"+n,"Daily Time Cann't be GT 24 Hrs")}}r.updateBindings(true);t.RowColumnCal()}},RowColumnCal:function(){var e=this;var t=e.getView();var a=t.getModel("oTimeshetModel");var o=a.getData().tableItems;for(var r=0;r<o.length;r++){var s=parseFloat(o[r].Day01)+parseFloat(o[r].Day02)+parseFloat(o[r].Day03)+parseFloat(o[r].Day04)+parseFloat(o[r].Day05)+parseFloat(o[r].Day06)+parseFloat(o[r].Day07);o[r].TotalHours=s.toFixed(2)}a.updateBindings(true);var i=0,n=0,l=0,u=0,g=0,c=0,d=0,p=0;for(var v=0;v<o.length;v++){i=(parseFloat(i)+parseFloat(o[v].Day01)).toFixed(2);n=(parseFloat(n)+parseFloat(o[v].Day02)).toFixed(2);l=(parseFloat(l)+parseFloat(o[v].Day03)).toFixed(2);u=(parseFloat(u)+parseFloat(o[v].Day04)).toFixed(2);g=(parseFloat(g)+parseFloat(o[v].Day05)).toFixed(2);c=(parseFloat(c)+parseFloat(o[v].Day06)).toFixed(2);d=(parseFloat(d)+parseFloat(o[v].Day07)).toFixed(2);p=(parseFloat(p)+parseFloat(o[v].TotalHours)).toFixed(2)}a.getData().tableColumns[0]["Total"]="Sub Totals";a.getData().tableColumns[2]["Total"]=i;a.getData().tableColumns[3]["Total"]=n;a.getData().tableColumns[4]["Total"]=l;a.getData().tableColumns[5]["Total"]=u;a.getData().tableColumns[6]["Total"]=g;a.getData().tableColumns[7]["Total"]=c;a.getData().tableColumns[8]["Total"]=d;a.getData().tableColumns[9]["Total"]=p;a.updateBindings(true)},onHistoryPress:function(e){var t=new sap.m.BusyDialog;t.open();t.setBusyIndicatorDelay(0);var a=this;var o=a.getView();var r=o.getModel("oTimeshetModel");var s;if(r.getData().tableItems.length){s=r.getData().tableItems[0].Lock}else{s=""}if(r.getProperty("/usereditable")&&s!="X"&&this.Saved!="X"){sap.m.MessageBox.show("Do you want to save your changes?",{icon:sap.m.MessageBox.Icon.WARNING,title:"Confirm",actions:[sap.m.MessageBox.Action.YES,sap.m.MessageBox.Action.NO],onClose:function(o){if(o==="YES"){a.onSavePress(e,"Save");r.setProperty("/usereditable",false);t.close()}else{var s=sap.ushell.Container.getService("CrossApplicationNavigation");var i=s&&s.hrefForExternal({target:{semanticObject:"ZProjectTime",action:"monitor"}})||"";s.toExternal({target:{shellHash:i}});t.close()}}})}else{var i=sap.ushell.Container.getService("CrossApplicationNavigation");var n=i&&i.hrefForExternal({target:{semanticObject:"ZProjectTime",action:"monitor"}})||"";i.toExternal({target:{shellHash:n}});t.close()}},handleProjectValueHelp:function(e){var t=this;var a=e.getSource().getValue();this.inputId=e.getSource().getId();var o=this.getOwnerComponent().getModel();if(!this._ProjectvalueHelpDialog){this._ProjectvalueHelpDialog=sap.ui.xmlfragment("ProjectTime.ZProjectTime.fragment.NewProjectCreate",this);this.getView().addDependent(this._ProjectvalueHelpDialog)}this._ProjectvalueHelpDialog.open();var r=t.getView().getModel("oTimeshetModel");var s=r.getProperty("/WeekNumber");var i=r.getProperty("/Year");var n=[];var l;n.push(new sap.ui.model.Filter("WeekNo",sap.ui.model.FilterOperator.EQ,s));n.push(new sap.ui.model.Filter("Year",sap.ui.model.FilterOperator.EQ,i));if(sap.ui.Device.system.phone){l="MidWBSTable"}else{l="idWBSTable"}var u=sap.ui.getCore().byId(l);u.getBinding("items").filter(n)},onProjectCancelPress:function(){this._ProjectvalueHelpDialog.close()},onProjectSelect:function(e){var t=this;var a=t.getView();var o=a.getModel("oNewProjectModel");var r=e.getParameter("listItem").getBindingContext().getObject();o.getData()["ProjectCode"]=r.ProjectCode;o.getData()["ProjectDescrption"]=r.Txt;o.updateBindings(false);this._ProjectvalueHelpDialog.close();this._ProjectvalueHelpDialog.destroy(true);this._ProjectvalueHelpDialog=undefined},_handleProjectValueHelpSearch:function(e){var t=e.getParameter("value");var a=new o({filters:[new o("ProjectCode",r.Contains,t),new o("Txt",r.Contains,t)],and:false});e.getSource().getBinding("items").filter([a])},_handleProjectValueHelpClose:function(e){var t=this;var a=t.getView();var o=a.getModel("oNewProjectModel");var r=e.getParameter("selectedItem");if(r){o.getData()["ProjectCode"]=r.getTitle();o.getData()["ProjectDescrption"]=r.getDescription();o.updateBindings(false)}e.getSource().getBinding("items").filter([])},onColumnNotePress:function(e){var t=this;this.onMainNotePress(e)},onMainNotePress:function(e){var t=this;this.oSrc=e.getSource();var a=e.getSource().getCustomData()[0].getValue();t.oCustomDataNoteskey=e.getSource().getCustomData()[0].getKey();t.getView().getModel("oTimeshetModel").setProperty("/Notes",a);if(!this._NotesDialog){this._NotesDialog=sap.ui.xmlfragment("ProjectTime.ZProjectTime.fragment.Notes",this);this.getView().addDependent(this._NotesDialog)}if(t.oCustomDataNoteskey==="ProjectNote"){this._NotesDialog.getCustomHeader().getContent()[1].setText("Comments")}else if(t.oCustomDataNoteskey==="MainNote"){this._NotesDialog.getCustomHeader().getContent()[1].setText("Add  Notes for week #"+t.getView().getModel("oTimeshetModel").getProperty("/WeekNumber"))}else{this._NotesDialog.getCustomHeader().getContent()[1].setText("Daily Notes")}this._NotesDialog.open()},onAddNotesPress:function(){var e=this;var t=e.getView().getModel("oTimeshetModel").getProperty("/Notes");if(e.oCustomDataNoteskey==="ProjectNote"){var a=e.oSrc.getBindingContext("oTimeshetModel").getObject();a.Note=t}else if(e.oCustomDataNoteskey==="MainNote"){e.getView().getModel("oTimeshetModel").setProperty("/VacationNotes",t)}else{e.getView().getModel("oNotesModel").setProperty("/"+e.oCustomDataNoteskey,t)}var o=e.getView().getModel("oTimeshetModel");o.setProperty("/usereditable",true);e.getView().getModel("oTimeshetModel").updateBindings(true);e.getView().getModel("oNotesModel").updateBindings(true);this._NotesDialog.close()},onDeleteNotesPress:function(){var e=this;var t=e.getView().getModel("oTimeshetModel").getProperty("/Notes");if(e.oCustomDataNoteskey==="ProjectNote"){var a=e.oSrc.getBindingContext("oTimeshetModel").getObject();a.Note=""}else if(e.oCustomDataNoteskey==="MainNote"){e.getView().getModel("oTimeshetModel").setProperty("/VacationNotes","")}else{e.getView().getModel("oNotesModel").setProperty("/"+e.oCustomDataNoteskey,"")}e.getView().getModel("oTimeshetModel").setProperty("/Notes","");e.getView().getModel("oTimeshetModel").updateBindings(true);e.getView().getModel("oNotesModel").updateBindings(true);var o=e.getView().getModel("oTimeshetModel");o.setProperty("/usereditable",true);this._NotesDialog.close()},onCancelNotesPress:function(){this._NotesDialog.close()},onProjectAddPress:function(e){var t=this;var a=t.getView().getModel("oNewProjectModel");a.setProperty("/ProjectCode","");a.setProperty("/ProjectDescrption","");a.setProperty("/ResourceType","");var o=e.getSource();var r=new sap.m.BusyDialog;r.open();r.setBusyIndicatorDelay(0);var s=this;var i=s.getView();var n=i.getModel("oTimeshetModel");var l;if(n.getData().tableItems.length){l=n.getData().tableItems[0].Lock}else{l=""}if(n.getProperty("/usereditable")&&l!="X"&&this.Saved!="X"){sap.m.MessageBox.show("Do you want to save your changes?",{icon:sap.m.MessageBox.Icon.WARNING,title:"Confirm",actions:[sap.m.MessageBox.Action.YES,sap.m.MessageBox.Action.NO],onClose:function(t){if(t==="YES"){s.onSavePress(e,"Save");n.setProperty("/usereditable",false);r.close()}else{if(!s._newProject){s._newProject=sap.ui.xmlfragment("ProjectTime.ZProjectTime.fragment.NewProject",s);s.getView().addDependent(s._newProject)}s._newProject.open();r.close()}}})}else{if(!s._newProject){s._newProject=sap.ui.xmlfragment("ProjectTime.ZProjectTime.fragment.NewProject",s);s.getView().addDependent(s._newProject)}s._newProject.open();r.close()}},onTimeEntryOkPress:function(){var e=this;var t=e.getView();var a=t.getModel("oNewProjectModel");var o=a.getData()["ProjectCode"];var r=a.getData()["ProjectDescrption"];var s=a.getData()["ResourceType"];var i=t.getModel("oTimeshetModel");var n=[];i.getData().tableItems.filter(function(e,t){if(e.Projectcode===o&&e.ResourceType===s){return n.push(e)}});if(n.length){sap.m.MessageBox.error("Selected record is already exist");return}var l={Projectcode:o,ResourceType:s,WeekNo:i.getProperty("/WeekNumber").toLocaleString(),User:"",Year:i.getProperty("/Year")+"",ProjectDesc:r,TypeDesc:"",Day01:"0.00",Day02:"0.00",Day03:"0.00",Day04:"0.00",Day05:"0.00",Day06:"0.00",Day07:"0.00",Note:"",StartDate:"",Lock:""};var u={TotalHours:"0.00",Day0valueStateText:"",Day0valueState:"None",Day1valueState:"None",Day2valueStateText:"",Day2valueState:"None",Day3valueStateText:"",Day3valueState:"None",Day4valueStateText:"",Day4valueState:"None",Day5valueStateText:"",Day5valueState:"None",Day6valueStateText:"",Day6valueState:"None",Day7valueStateText:"",Day7valueState:"None",valueStateText:"",valueState:"None"};var g=this.getOwnerComponent().getModel();if(o!==""&&s!==""){g.create("/TimeSheetSet",l,{success:function(t){sap.m.MessageToast.show("Timesheet Created Successfully");e._GetData()},error:function(e){}});this._newProject.close()}else{sap.m.MessageToast.show("Project Code and Resource Type are Mandatory")}},onTimeEntryCancelPress:function(){this._newProject.close()},startOfWeek:function(e){var t=e.getDate()-e.getDay()+(e.getDay()===0?-6:1);return new Date(e.setDate(t))},GetDates:function(e,t){var a=[];var o=this;var r;var s=o.getView();var i=s.getModel("oTimeshetModel");for(var n=0;n<=t;n++){var l=new Date(e.getTime()+864e5*n);if(l.getDate()<=9){r="0"+l.getDate()}else{r=l.getDate()}if(sap.ui.Device.system.phone){a.push({DisplayDate:this.DayAsString(l.getDay())+"  "+r+" ",Date:l})}else{a.push({DisplayDate:this.DayAsString(l.getDay())+","+r+" ",Date:l})}if(n===6){i.setProperty("/EndDateMonth",l.getDate()+" "+this.MonthAsString(l.getMonth())+" "+l.getFullYear());i.setProperty("/EndDateofTitle",l)}if(n===0){i.setProperty("/StartDateofTitle",l)}}return a},MonthAsString:function(e){var t=new Date;var a=new Array;a[0]="January";a[1]="February";a[2]="March";a[3]="April";a[4]="May";a[5]="June";a[6]="July";a[7]="August";a[8]="September";a[9]="October";a[10]="November";a[11]="December";return a[e]},DayAsString:function(e){var t=new Array(7);t[0]="SUN";t[1]="MON";t[2]="TUE";t[3]="WED";t[4]="THU";t[5]="FRI";t[6]="SAT";return t[e]},handleLiveChange:function(e){var t=e.getSource(),a=t.getValue().length,o=t.getMaxLength(),r=a>o?"Warning":"None";t.setValueState(r)},handleDeleteRecord:function(e){var t=this;var a=t.getView();var o=a.getModel();var r=encodeURIComponent(e.Projectcode);var s="/TimeSheetSet(Projectcode='"+r+"',ResourceType='"+e.ResourceType+"',WeekNo='"+e.WeekNo+"',User='',Year='"+e.Year+"')";o.remove(s,{success:function(e){sap.m.MessageToast.show("Timesheet Project Deleted Successfully");t._GetData()},error:function(e){}})},onProjectDeletePress:function(e){var t=this;var a;var o=t.getView();var r=o.getModel("oTimeshetModel");if(sap.ui.Device.system.phone){a=e.getSource().getBindingContext("oTimeshetModel")}else{a=this.getView().getContent()[0].getContent()[1].getSelectedItem()}if(a){if(sap.ui.Device.system.phone){a=e.getSource().getBindingContext("oTimeshetModel")}else{a=this.getView().getContent()[0].getContent()[1].getSelectedItem().getBindingContext("oTimeshetModel")}if(a.getObject().WBSType==="A"||a.getObject().WBSType==="V"||a.getObject().WBSType==="C"){}else{sap.m.MessageBox.show("Are you Sure want to delete the Project",{icon:sap.m.MessageBox.Icon.WARNING,title:"Confirm",actions:[sap.m.MessageBox.Action.YES,sap.m.MessageBox.Action.NO],onClose:function(e){if(e==="YES"){var o=a.getObject();t.handleDeleteRecord(o)}}})}}else{sap.m.MessageBox.show("Please Select Atleast One Project",{icon:sap.m.MessageBox.Icon.ERROR,title:"Error",actions:[sap.m.MessageBox.Action.OK],onClose:function(e){}})}},onMobilTitlePress:function(e){var t=this;var a=t.getView();var o=e.getSource().getBindingContext("oTimeshetModel").getObject();if(!this._oProjectPopover){this._oProjectPopover=sap.ui.xmlfragment("ProjectTime.ZProjectTime.fragment.Projectpopover",this);this.getView().addDependent(this._oProjectPopover)}var r=e.getSource();var s=this._oProjectPopover.getContent()[0].getItems()[0].getContent();jQuery.sap.delayedCall(0,this,function(){s[1].setText(o.Projectcode);s[3].setText(o.ProjectDesc);s[5].setText(o.ResourceType);s[7].setText(o.TypeDesc);this._oProjectPopover.openBy(r)})},_showObject:function(e){this.getRouter().navTo("object",{objectId:e.getBindingContext().getProperty("Vbeln")})}})});